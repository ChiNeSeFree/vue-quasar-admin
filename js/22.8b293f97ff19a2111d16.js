webpackJsonp([22],{Ao2G:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("woOf"),o=n.n(i),a=n("BO1k"),r=n.n(a),l=n("mvHQ"),s=n.n(l),c=n("Xxa5"),u=n.n(c),d=n("exGp"),f=n.n(d),p=n("wY7H");n("mw3O");function m(e){return Object(p.a)({url:"/function/pagedlist",method:"get",params:e})}function v(e){return Object(p.a)({url:"/function/del",method:"delete",params:e,loading:"hourglass"})}var h=n("jmBq"),b={name:"function",data:function(){return{serverData:[],serverPagination:{page:1,rowsNumber:0,rowsPerPage:10},columns:[{name:"module",required:!0,label:this.$t("Module name"),align:"left",field:"module",sortable:!0},{name:"code",label:this.$t("Function code"),field:"code",sortable:!0,align:"left"},{name:"name",label:this.$t("Function name"),field:"name",sortable:!0,align:"left"},{name:"id",required:!0,label:this.$t("ID"),align:"left",field:"id"}],filter:{module:"",name:"",code:""},selected:[],loading:!1,editModal:!1,menuModal:!1,tempFunction:{id:0,name:"",moduleId:0,module:"",code:"",description:""},menuList:[],menuSelected:0}},methods:{request:function(e){var t=this;return f()(u.a.mark(function n(){var i,o,a,r,l,s,c,d;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.loading=!0,t.serverPagination=e.pagination,t.$refs.table,i=e.pagination,o=i.page,a=i.rowsPerPage,r=i.sortBy,l=i.descending,s={pageIndex:o,pageSize:a,sortBy:r,descending:l,filter:t.filter},n.next=6,m(s);case 6:c=n.sent,d=c.data.data,t.serverPagination.rowsNumber=d.totalCount,t.serverData=d.rows,setTimeout(function(){t.loading=!1},500);case 11:case"end":return n.stop()}},n,t)}))()},delFunction:function(e){var t=this;return f()(u.a.mark(function n(){return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$q.dialog({title:t.$t("Delete"),message:t.$t("Confirm the deletion？"),position:"right",ok:{push:!0,label:t.$t("Delete")},cancel:{push:!0,color:"negative",label:t.$t("Cancel")}});case 3:return n.next=5,v({id:e});case 5:t.$q.notify({type:"positive",message:t.$t("Successfully deleted"),position:"bottom-right"}),t.search(),n.next=11;break;case 9:n.prev=9,n.t0=n.catch(0);case 11:case"end":return n.stop()}},n,t,[[0,9]])}))()},delFunctions:function(){var e=this;return f()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$q.dialog({title:e.$t("Batch deletion"),message:e.$t("Confirm the bulk delete operation？"),ok:{push:!0,label:e.$t("Delete")},cancel:{push:!0,color:"negative",label:e.$t("Cancel")}});case 3:return t.next=5,n={ids:s()(e.selected.map(function(e){return e.id}))},Object(p.a)({url:"/function/batchdel",method:"delete",params:n,loading:"hourglass"});case 5:e.$q.notify({type:"positive",message:e.$t("Successfully deleted"),position:"bottom-right"}),e.selected=[],e.search(),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:case"end":return t.stop()}var n},t,e,[[0,10]])}))()},editFunction:function(e){var t=this.serverData.filter(function(t){return t.id===e});if(!(t&&t.length>0))return!0;this.tempFunction=JSON.parse(s()(t[0])),this.editModal=!0},selectModule:function(){var e=this;return f()(u.a.mark(function t(){var n,i,o;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.b)();case 2:n=t.sent,i=n.data.data,function e(t,n){var i=!0,o=!1,a=void 0;try{for(var l,s=r()(t);!(i=(l=s.next()).done);i=!0){var c=l.value,u={id:c.id,parentId:c.parentId,label:c.title,name:c.name,path:c.path,icon:c.icon,leftMemu:c.leftMemu,functionCode:c.functionCode,isLock:c.isLock,sort:c.sort,children:[]};c.children&&c.children.length>0&&e(c.children,u.children),n.push(u)}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}}(i,o=[]),e.menuList=o,e.menuSelected=e.tempFunction.moduleId||0,e.menuModal=!0;case 10:case"end":return t.stop()}},t,e)}))()},findMenuById:function(e){var t={},n=this;return function i(a){var l=!0,s=!1,c=void 0;try{for(var u,d=r()(a);!(l=(u=d.next()).done);l=!0){var f=u.value;if(f.id===e){n.editingMenu=f,(t=o()({},f)).children=null;break}f.children&&f.children.length>0&&i(f.children)}}catch(e){s=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(s)throw c}}}(this.menuList),t},moduleChange:function(){var e=this.findMenuById(this.menuSelected);this.tempFunction.moduleId=e.id,this.tempFunction.module=e.label,this.menuModal=!1},saveFunction:function(){var e=this;return f()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n=e.tempFunction,Object(p.a)({url:"/function/save",method:"post",data:n,loading:"hourglass"});case 2:e.$q.notify({type:"positive",message:e.$t("Saved successfully"),position:"bottom-right"}),e.editModal=!1,e.search();case 5:case"end":return t.stop()}var n},t,e)}))()},search:function(){this.request({pagination:this.serverPagination,filter:this.filter})},addFunction:function(){this.tempFunction={},this.editModal=!0}},mounted:function(){this.request({pagination:this.serverPagination,filter:this.filter})}},g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{padding:"10px"}},[n("q-card",{staticClass:"fit shadow-6",attrs:{inline:""}},[n("q-card-main",{staticStyle:{height:"80%"}},[n("q-table",{ref:"table",attrs:{color:"primary",data:e.serverData,columns:e.columns,selection:"multiple",selected:e.selected,"row-key":"id",pagination:e.serverPagination,loading:e.loading,"rows-per-page-label":e.$t("Rows per page")},on:{"update:selected":function(t){e.selected=t},"update:pagination":function(t){e.serverPagination=t},request:e.request},scopedSlots:e._u([{key:"top-left",fn:function(t){return[n("q-input",{attrs:{type:"text",prefix:e.$t("Module name")+"："},model:{value:e.filter.module,callback:function(t){e.$set(e.filter,"module",t)},expression:"filter.module"}}),e._v("  \n                    "),n("q-input",{attrs:{type:"text",prefix:e.$t("Function name")+"："},model:{value:e.filter.name,callback:function(t){e.$set(e.filter,"name",t)},expression:"filter.name"}}),e._v("  \n                    "),n("q-input",{attrs:{type:"text",prefix:e.$t("Function code")+"："},model:{value:e.filter.code,callback:function(t){e.$set(e.filter,"code",t)},expression:"filter.code"}}),e._v("  \n                    "),n("q-btn",{attrs:{push:"",dense:"",color:"primary",icon:"search"},on:{click:e.search}},[e._v("Search")]),e._v("  \n                    "),n("q-btn",{attrs:{push:"",dense:"",color:"primary",icon:"add"},on:{click:e.addFunction}},[e._v(e._s(e.$t("Add")))])]}},{key:"top-right",fn:function(e){return[n("q-btn",{attrs:{flat:"",round:"",dense:"",icon:e.inFullscreen?"fullscreen_exit":"fullscreen"},on:{click:e.toggleFullscreen}})]}},{key:"top-selection",fn:function(t){return[n("q-btn",{attrs:{color:"negative",flat:"",round:"",delete:"",icon:"delete"},on:{click:e.delFunctions}})]}},{key:"body-cell-id",fn:function(t){return n("q-td",{staticStyle:{width:"100px"},attrs:{props:t}},[n("q-btn",{directives:[{name:"permission",rawName:"v-permission",value:["function_edit"],expression:"['function_edit']"}],attrs:{small:"",round:"",push:"",glossy:"",dense:"",icon:"edit",color:"primary"},on:{click:function(n){e.editFunction(t.value)}}}),e._v(" "),n("q-btn",{directives:[{name:"permission",rawName:"v-permission",value:["function_del"],expression:"['function_del']"}],attrs:{small:"",round:"",push:"",glossy:"",dense:"",icon:"delete",color:"red"},on:{click:function(n){e.delFunction(t.value)}}})],1)}}])})],1)],1),e._v(" "),n("q-modal",{attrs:{maximized:""},model:{value:e.editModal,callback:function(t){e.editModal=t},expression:"editModal"}},[n("q-modal-layout",[n("q-toolbar",{attrs:{slot:"header"},slot:"header"},[n("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"reply"},on:{click:function(t){e.editModal=!1}}}),e._v(" "),n("q-toolbar-title",[e._v("\n                   "+e._s(e.$t("Edit"))+"\n                ")])],1),e._v(" "),n("q-toolbar",{attrs:{slot:"footer"},slot:"footer"},[n("q-toolbar-title"),e._v(" "),n("q-btn",{attrs:{round:""},on:{click:e.saveFunction}},[e._v(e._s(e.$t("Save")))]),e._v(" "),n("q-btn",{attrs:{round:"",color:"red"},on:{click:function(t){e.editModal=!1}}},[e._v(e._s(e.$t("Cancel")))])],1),e._v(" "),n("div",{staticClass:"layout-padding"},[n("q-field",{attrs:{count:15}},[n("q-input",{attrs:{"float-label":e.$t("Function name")},model:{value:e.tempFunction.name,callback:function(t){e.$set(e.tempFunction,"name",t)},expression:"tempFunction.name"}})],1),e._v(" "),n("q-field",{attrs:{count:15}},[n("q-input",{attrs:{"float-label":e.$t("Function code")},model:{value:e.tempFunction.code,callback:function(t){e.$set(e.tempFunction,"code",t)},expression:"tempFunction.code"}})],1),e._v(" "),n("q-field",{attrs:{count:20}},[n("q-input",{attrs:{type:"textarea","max-height":100,rows:"7","float-label":e.$t("Function description")},model:{value:e.tempFunction.description,callback:function(t){e.$set(e.tempFunction,"description",t)},expression:"tempFunction.description"}})],1),e._v(" "),n("q-chip",{attrs:{small:""}},[e._v(" "+e._s(e.tempFunction.module))]),e._v(" "),n("q-btn",{staticClass:"bg-brown-5 text-white",attrs:{label:e.$t("Selection module")},on:{click:e.selectModule}})],1)],1)],1),e._v(" "),n("q-modal",{attrs:{maximized:""},model:{value:e.menuModal,callback:function(t){e.menuModal=t},expression:"menuModal"}},[n("q-modal-layout",[n("q-toolbar",{attrs:{slot:"header"},slot:"header"},[n("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"reply"},on:{click:function(t){e.menuModal=!1}}}),e._v(" "),n("q-toolbar-title",[e._v("\n                  "+e._s(e.$t("Selection module"))+"\n                ")])],1),e._v(" "),n("q-toolbar",{attrs:{slot:"footer"},slot:"footer"},[n("q-toolbar-title"),e._v(" "),n("q-btn",{attrs:{round:"",disable:!e.menuSelected},on:{click:e.moduleChange}},[e._v(e._s(e.$t("Select")))]),e._v(" "),n("q-btn",{attrs:{round:"",color:"red"},on:{click:function(t){e.menuModal=!1}}},[e._v(e._s(e.$t("Cancel")))])],1),e._v(" "),n("div",{staticClass:"layout-padding"},[n("q-tree",{attrs:{nodes:e.menuList,"default-expand-all":"",selected:e.menuSelected,"node-key":"id"},on:{"update:selected":function(t){e.menuSelected=t}}})],1)],1)],1)],1)},q=[];g._withStripped=!0;var _=n("XyMi"),y=Object(_.a)(b,g,q,!1,null,null,null);y.options.__file="src\\pages\\permission\\function.vue";t.default=y.exports}});